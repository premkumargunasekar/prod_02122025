---
# roles/gcp_subnet_multi/tasks/main.yml
# Orchestrator role â€” runs on the target host and delegates processing to subnet_unit role.

- name: Validate incoming req
  assert:
    that:
      - req is defined
    fail_msg: "Role gcp_subnet_multi requires 'req' variable"

- name: Ensure required supporting values are defined
  assert:
    that:
      - env_data is defined
      - subnet_data is defined
      - region_map is defined
      - scripts_dir is defined
      - subnet_csv is defined
      - gcp_project is defined
    fail_msg: "Missing one or more required facts: env_data, subnet_data, region_map, scripts_dir, subnet_csv, gcp_project"

- name: Call subnet_unit role for this request
  include_role:
    name: subnet_unit
  vars:
    req: "{{ req }}"
    batch_index: "{{ batch_index }}"
    env_data: "{{ env_data }}"
    subnet_data: "{{ subnet_data }}"
    region_map: "{{ region_map }}"
    calc_script: "{{ scripts_dir }}/calc_next_subnet.py"
    update_script: "{{ scripts_dir }}/update_subnet_csv.py"
    subnet_csv: "{{ subnet_csv }}"
    gcp_project: "{{ gcp_project }}"
    gcp_sa_file: "{{ gcp_sa_file | default(omit) }}"
